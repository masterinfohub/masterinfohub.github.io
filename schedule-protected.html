<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "fuLvxhi2nhyINZ5kMMFoNFipJDKI9ACDiJBRl8YPJ5WFge3jqdVFm+P5uVbHH3L5QWvQM8csZfrH2/QLHxe1FP16CS0PjwDjYj1l8actJ/NPP4IwZEvykycLhy/UUZ+V3tfaoxxsB13NakdLxwTJ1irFTDDtR1dm/BMF6SNkmSIy3pQHA3Q9lZWajSwUp0riYVitftEw/1VydiFCiVoQMvnqY4xxDnMALX4EH+sFeaSKEiUtwmO+6OF5kPgmXMzythYASzO/9RzSTQAfCT2bQy0ER9EHzwEYps5t6S16AIBpwKicf+T/5C2Sp6joFr5lhonaIvA/uSU8F1vGaZDG+qFJ22jZH37DAtbVSAlOWrSZibs+msuZHd5sqmM1S6VXveQxrpy5JkZcl/WouMTZiEgg7NisH+zXQruNrbBU+GF50e5BwmIBkjrNAL3ngtvWQ2lYIZEy/axW/O6JX7mcY3DbXGjFIaNX1LeiyfWizppOAcdsRFoKD/MrddhtwoFEl2JhyZTZjiYr7pgL6bufp84Jg92shYENGXsRcvllKw6YpunODg02bIFA9jE8ezBol/M9N3vZoP0bcpbSBUU0QcZrFuP+A90a4zzN3Hx3PwVHLbK9e9bt3uyi7s14AN715KvgDqxDLhXFia7P4Wk2ZX3X9UM52VM+UL8o/74VDktEBW8amR/7HopS1T36Jei368f/yPuFXqV2loyQX4FnrkFRe7JXrunrkrngxBVaV8Mil+P9Vsr5S4zD130IRhIuaboTh1SCxCxWndG1fL2pGeahJw0G3JzTNnS4McX+byR9HyHfLP+iN5F1t03nNxpU9gAwhoVVzI7eRknTu+8+h8q2Juy738wvZ7mQYYVVH4h1tVYzeq4+Fj6fbnWYU9GcibdkuY5SCjPxRauK24ubmWP14R8vXgJOJ2F9b13MIQAw1tcPtlqx4NsCqKiw4Vtl/NkJQzOkYAJO1ZflfUmqS9CoyhhYIWUGcs6XvppTADXaRxeyqYC0WRF26ashGqFWp/t0NY7+lVukiksWqR72KKlZiCOgHWsndJajC2ukO4rN6QaYuOeyjXkFX5b+yfz8xUpZApzIAGcN+F3HSThZi7boR6LxvtnjAGK+X8Ur5yarEZ2ocdu1lVwlgM5BOIya3kmFO8hgbvF0riGVMHS5thcKI/ItBomjpz8YyW2BnjdJFq6u6y0ShgsHfAhjl+rSropgO1zfcTQCiWk4m1N4jHwWhWciX8RREYE583E3E0I0zjF3Lh0kI/Wpy90sIQQQr3SLKy8n3fgYncxNxMYcErJvT1SdCVSfwwUBhLuFSNTNw0GS8LnFbpNkSACZGufs2p5dXwJ8nK7TTCTY+BJqAuQ4vsqdo5VNifUGiT3zwUvtBSKi24CIqRal0GIr8dTs7iUrDBAHbMC5H+dPKVSbm3p12cfSIu2xYayeGj5kZNSDPerP9be+FpmMCy7rmOVVY6Mk1f5+5a9ErOlKsqggSGqDWrvqswbLvJOsQxPi3sCDpnFrCNF74j216BOFypbKNlcIVjg3Md2yn6HNPdIH9KlLOTb73pqAmTiFBzHP10QHxuMZHBVc1+Sh0u+BozWpeuRmT0+Q4UHAvlg5sGue3QqzmZpSWQHuiYDblmskKB7bxyDUOVV3HlqndG8UlQdfQmt1J3qMvYufZ6cpfMuPZTZKASlSN8V7OsFled25N7dgpLx/lkyrKRglLA0UnhvbLml8qgtr7cbcGvm1IlHKhi0COt8Srs8mGKp+sjpc9KMO4cdzy1mOPLWbH5L5KUj9Xk5bQDDvJmUsHG5oyo6Ae34A6AnnBU3Cn+MospTOdg5KsRkyePb8VHtoXDQTnvr/2TWT4/e9HWC3nnKJiJrcNz9+9rpHEKYMqDEur2nzCdSFlipXfyU8kNsLBbV9Zbv26ocQdiYa/EJdugOvlJP8QWb58Pfxi4QXn24UpFbjP4oVU4CoAtmJ27+fDo39fAfUi0kijOasw0nP+QYb14SnLHbFYZ67e9ZoWvv484vBYSBUHFse3TvLCRzWMHuz3XbyGwhSuodRgryYl8bWCbYZfEsT1V8vJ8ZT+gzN5nhkSKQ36nTvT5lbchrH/+uxBa8XrSOaZhnDISH8BBXJVStYZO5Ant5DbD98gavtxE/3urAhaetriFur0q23TzTBc/9LkKAOfbs+ZQu4di//V9NykNYGeGQLqAoyQfswDXmVxEa5o+Y16HOZqf3iLfZUg7QTPn6LmzTM8ikm4jdAfcPd8PiQSdKJX4oDy4pJOo5UeaeH4gobC1Ft/yN8K85cecBSSR7ofxaKl+/Rontrrju6RtfjAFqZVgkcxYRaYT1poABD8yoHNcNXF9QuJA7BjWl3omJGpJLaYskdC2Dk7fPX7Qv+9mHtkjAiXYElsrS7xXA5j67LIXnq3io0dTYN4N/71Gv2RHppzXd1N2WztnIwbjKz0rhBN3krXODe9yw4DJCAkmFUtqmNtKCLypb3a8ljvVZ+4YGY6ERgsvKAQ+IYoEhYe9uT/vsZcA6T/mnJPWFppxkDYwrsGnR/O91zkDpI0NBpBlazNjSXEbPxAhgn+m7rh2gDhFHour4yfAelDZaFzZSqeLAeXhJgsih83xZ8LsoU40s7do6v64AKj4tFl/+4B0zto3UpcIOr+jGClXrBHBnuBs0vcHgnN8R8EEbNmi9BEiCdu/LOcz+BXmyXSXvo+KdNQZFn8QwuuJbqq3Y4W2yQVtJ2tA1ZiOZZEO4rl8Ozpf2uj4T+p0jG1pOpprLVo2sVJkVttH/m+4yv1BaR7QXqpBzAK/IYIOiIRzEmWMqiaG7lYV5TkpwnDu5jNRvC+b9/47cPu272XNqr3P/r3SzPj+K0hNhADU0jBJz+OrbovGA6dMEYuO3H5DSqxXwowUJDvtT10xh7O4lkmC+85oYcoykwtPG4poYv4T+p8u21ciOqwQAsYvYQI4aj6efMuHUfY8Mlm53pZg4Ek1WCAvjjavLr7RL+Ykhq4r7946DvrAqUh0yrVDXkwA7M6tOMz6lO5mtbovkRUoTK8RYs4u49iv3pk50qGjVyvhtJNESoOjJlvaAMIHYRnqYhKOwdb3/a+uMb1tUpN9t5+3vmNkFjZ4QrlhIReq7drVgW3MkNOXmX4CR5nV+5Uns7bS2ZyPJDkqQFezLw60yTTVd/qTsm/J5Zro64j97/7nGp79be5JN/FXzgFBx8zOdWPceMu8z9/Ec72iFEvceotdthWD3hIoGUpqsumOkhnhgGA01zUNGrd/lIfKpscpwvNpv5IQIVw1tVlsb6XN+ezSfx5C19f8Oxi0X6AWc/u5vCnpR8UTILO/xiIoASrSHYedItkHk3yLFvfU9UTK7J2NF3N/4SkyP7iDfs3p4NXeatCWg2MzcmVdNidnZkqhb3/d58rXiN1bnSLLx6o4ec4wFW1jg3KHImq6V5Tf1z+g/GKRO/NLlAPjFdgbdIVgnNF6EanQr1Q7eMiWf4x/i2jx8VoWrJJ1Py5bGeLSyeBAxJVjlffLqkxjJgd4HYzar8s4nP+kcrLSmbcmgtJBo7/wI26jws3sx4Rou+U2/vqarFO3hrT3qP0VqSqy2gSIpq9MeJPpB229uCba9eAGHkJzQ8XKSJK/2dFihLO1uhcQHZxw2t3Xra+K3bqcObq4Eah2ixV8CxiQYqpm8HaOv0jrm23ER2ZpkbP1ZHALhYBsLFDB6QJYmx3GC6nEtIheEODhoqOospAXR9Ethh9XnMutYAifvFFADjyq0ak6o/w4XZ3yQyfLsfG2H621x2yzU9EC6cIXFcOntx6lIoCtYIantD9DnbwnjlgAq/msLwPtqMvjgQDc1VzZ5TKwYoG5jvqcbg6xJt1XFJCnrRoyskDKADE1f/mqFMMLX4nLOAEtRNPtDqeWBGxQ5QMsT8iU8WNCuBdMcCQU0EDrztcXvKff8nJMuigzFhOdkqqu4GfK0baLLTvxAvMx/N6Nxv7IZ99SYVgANmp0TG1LMp8l/aIiDrgd4eMWI9D11waUEJ8aXshIFfU06VByw0SNEJDkrnLHIzzXnYrRkg+CzlPfHa9jotrPrHLAahDR4hxoNz3oOuIeS0VgBVPcc46l+xIImF4+kotJM0SWkmV6EQB7LtyOBDOnrVe1BhyuptLCcglEhDV9KHgZHbLahTXD7OU50p7yKR9s2h2bwKmXN7t2DnH0uKmk/j6sgK+Im15ABZfFpD9QM2lv29v6p+D2RSrJ5HnySdCK62UtYNwck964mjwMNC+z/zAfdlgJzxflTC0LeL3GDKZbRBopgZxTlwHvmud4vVD2mEdEUVoTVYGDYCxqXaoBwnUawLZCzIcXlwKIcOtwDbOtZHPRMhyifR+y3G7WlsaZHiy2ceue7ARd5HK2VvpKOUAYD5ddYj/R/Nkbei+1v5Wu/9h48I5qwXEeBxVfF11wjMJehFoh88CQjsSFZMixQf/uptlIyGeH9rLTzcbcGoum3zRiiY/MVgX0/q2ZDfV2Hp4EPerszJYNHlzsjrnUbwhQygyUKj0c26SLbjhgJNtBJ1ikJvwDZu171hwNpf6kx9aBxZB82XMzhnpZvBYWmg53rsUonOyXby9b6+fE3XDDFvp4s6eu5ou95rWVOLoysKSo6lU6f6nG/DkOn8obliJeoAFfnM7RYCisJ9gjbL5YxF7BM3GdcojH94B08gSTsTQQRrdFUqyGpb3W8weWV0h6Q0vI8fbYhELgUqtqp6Fa3sz+CPxHqsxiSbLByoldUQVfi3q2LmzMJco+U2NkSDHnnkFOWOUeZHx7Ujj2hZ4cGvGqtu51Vu9FABauBYpL5dsr2X8C0LvDLGligHHySJonnV32zUrD8Sk7m+bhS5OlpAdKUEtmMYj87FATuOxddFgIwaw2k43lkN4EsPULbH2Lyn+MkyxExUd7znBE74GdHsGq/rHJG7wpFz+FYp9kERNJOp89K2z/p+pVAW5b97u3u/eUk4gjxVoSpTkHkKMYdHTmkxsATnyVApYNt2wz11ax9eEbXHfbcJZlTr8+APP9M3JAeRRZO0cIDaCjrVyxXnT3EZ19WtcGeboUc8FpKF8ptTxZzrKFwjK26d+8AB7+8fVZbqAZBMxviEZ081IKk6cqaRVUCQdzVnf7m+NAGk524bi5CJw7RWiZu7NH1aehg+F5FwdzvZzdS5DdaPjeEfzPQj6jMkctiCKQkXFnAIk9DAN6ch3oyg571iCJdniHrwPpX8LclQsY3tPQ3wSM7Q9xbHfPaxk/FVW2WzFk1TY05pFF5+s470pSkQ+48Oj2FhxZ8C2OnXRSQUrGZwhItQde3EQkKtlDByD7S17UkvDxMGbG3bb+UQzl3qJmoUknKetgJhstnfIuhLGsJkjKxZ0oUv2yek+dMm0xIIFWmon5hZ4NEY7Q+1rU46VMheNCxsRaXvlqjpGdnzQfCWMyrYMjN76jjfq5Fk53Ht7yNeor3tqheTs3AFVeULL5UUUXsLEaSKBMxAGdSmYiRMQ0DFaBfh+QmHXZMmbpjwGtEwO+qY1nYMDchF6p11EHu5w2rOr+9ZEL0y3YRb9q4VK/Pnq6QjI+0ZXhIsar5p/YDqKIh6qDlJRcOhddH/gOsiv0nwclpQuQrkV7v3dO7f61AAcgfRqXY80N8BB3Y1t7lm2lvHsk/FAquKo1o3BPo248ggOe5fnL/yxNdWrnOXxAN7Iw+IRvMStBlt02KnJkZscHTd0FHzyrfL/vA4RQtj/xstcakCa3C+eKDO7m8MZAuEVeoUbwqfvelVFO9KO9XWlMzqgmZFdQW557tKVndrZ95GrnXeENtSs86kwD40XklY9RyTsMzPauZtxh7e709yzyrEo/vVfATf75WY3FIsklw9hEW+RPuE6XBX2wKZmtLYnT3MY9kerpGLJgeahfebt9qpp2NXjfUVqAo3GG+g0D6qlr+xneeVksrC3jpLMarTeVcjIjI6nhS53LivJtKXks3gKanRZb1pUxk7mcM/m/nIrdTXM96brvSA4oNESy0uoROnFnKESXHHCGp7qRvK++9/Ll8P+pTjQ1lqfMcb+RExEivLCP6+DIkjcfN8arOmaqFOzeE/Lsj5VVS0Lq8hB4MnLoLTR6d5IuhUopZg8ihzymL6wn6cRkvzbsOrfP/mXPojobe51LJxZ8FUmhy2/st1Nt+8O1TSULSWpyfmS5Df5Zhad8uw8hziu/YjTG436qeAWSRY1opCj1RFqr76b5woAwlq0QY4aZ1DvTbZXfQBwWOjp1bbFLglZXOHXPQmuULy3OXpX7Yb99iEAjKsPRF1ZgJq5vNLyWGEFTGLlOjElnQKhysfMWpdmtABgNYKZKPyFw9QgrU92O4op91mOisU6i3JHuWa5RrClpcHG6cf9SbVsZCTmGn6vD7QKRs5EoAlTCT9lAsFuKB6Fh5hBz510EZ5UU6xVryX/PAKvAHq+VJLl28Tnz4JuwtRQvB+Lo4cecgNvbBV7hrKDZT8PXVaY6P7K6BlhasjAEVyqRYWjvkWMzbt3bF3+JYd5D/6NE+LsXxPVwFgiQNkmRYF+rMa/9FUS9TCaUSfXcTDMbnzCEBbVsLqpm1d8w/xOQXYtJYwaGGRR394er1uddAx8Wi3CM/KK0r0fuX1MJzwMDaEJrq876hHug6qaHyRkxTPHJnlG6H5cjgr+104HGgdy7PPE8g5xOvOGjDqDCSQowJ5VaeaIKGy8vXBff3YJ/dxe6j/TEqLPo3Ogqbj1oEEAlVWepYJbz1cv3cMfZC1/N0TiC1ItBXtBMYoY7cz+SPkrnf9j0oZFjoQDgQ7CORojn7ugGRdrsxzZqNPq9OlnLDm1Z1PC6zIXl7k1KJDeMcgsSeuUbghr8aJ/LZA+BhOYlu9Mu/eTlZ/b6I45ufCjpnZuJz4hX5D03Ch3VW8ywg10XfDnan0ov+DU+zTOElPWUpnchgEemvQOmc13reLo/S/H2eNXhSatHTrHO7/g0Lzk42mQMIt2uT+Nxm+yr4Wpq0sWN4hjJnMpgr19qXt2QnW5BHn4oXpN7zr2jhrrMP3WOXPdnaC/dEL94+cyt/td/9wmvNxWgyMFG6inwg8X0L19qVqdSrw7A6gP/95tLjl7FZKytd8KZFjwILoNxUtX3/t8+0jBE0TFx1cTCrhl8VSQWsZ08ScaAg+Y1VHGCgapgC8yq8VFFEPhcn1hfhwAsNN";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
