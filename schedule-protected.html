<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
