<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
