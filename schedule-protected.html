<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "2+7oHpGemZA/5OGHzHi40D+xl8ysHI0vqkTMDl2LqNZE1iaN0mb8AIkAffGJsmBQPI3cgd7tBPKhtOjawgeeb+vPxsELvPPEOLS09TCsmNw4nUYa/rUtXZH6z034E22zqdCez0I8EPTsZbd43yb2rfcZds3iO3XQjzyd+8WPvQD9IIjjMQXQLRqovDf5XAxDVHYfs4XKEoMmqt0eryHcJeLtM+9Aj6gvbobgVl8sm1p7BWRbw1Dvg/cWnDEQcz0qdCX4fTp1UaEu4LZbQfc+vmO7Z1E1sYrMBTy9G0YqkLRw3/OR76RdsKyfmX9l18oPpQjNT1Wmnl4EJAKnPy6tdqYi8QmwinvWOU1AfQ9MtcYgHBXKvGmqOfcKh3e37gZ4+mzQa0HubQmYkh0yGXXEb+bR9igFjPBF11aSDa/2jFs3d+vktWoDgtWtHT1jv088aFxqxHCgfezx6IukYJwoQJCMOVo3tcwBByW0aBtMiiLfCfvRpzrNWKrtlpqvG05XXvYmVzShaZW4lHAexBmbsnhhR994Z5quV1IySgBYfRjEJWp17lJRVmcVuNnRrIzwd2r9uHDdm754NI5DdeOHVbLxZ+sWM5upiL7+JcrDo6OwJAYEII6c53OrCFe/P952X8//szLd87sqCex4t6DvhSsAjHaHnLTn+3CStXLWYJsauH+Lx9cMb5+mFUEYdtWq6cOt1lvx2chcPeXaSrSYl2fZj5J7wteJmOKHymqdhfdfIDVksJIuGXpArxAod0Fzy9QR5sbSfJjzuSOyTdlo04PR9dhYJyYjNDm5KGm9RHUsip+ar8UmkfdgyWaJCh0wDySE9L2jO4XUvXTTA0XhvYZHWJb/evBMDjv1ATYqmfzQowjphjhhc+s+J9Heq3hXCXM0H3UPSivZZbzkes8VmA3ejcU70FOfqkq7dPKtNT8f1cSL6vQYIzKtuHNGYfOkJjFvVBUSpGNobSI/1C8NMBiYGChyYKh7vCgXXB2NIJgsLxj2sZuXJbnGx54hWC4mBy7ekdM0V7LD9jdkzjLIN7rs+y11dMSaicvoFXTF7yGEdvl214oqwCxJxJObgZaVOw/RDJag8fdHjm/Hthx4tw3amql6hlaRCwRh8bZBepHuRrYlsxmghf0bW9RCHIw1+ceBDnuajBjRkNH4ka7FEM/Ua/RLOcX9MrT9VTwiNjE10e4fkrqZ8TO1hFybyN8zFWDNBf/a5LwFvEuuayiIiP1MnigmYqyjekaEpx0NeQDuvvsl2hgfBBINt/v4laKqMkIVfQVPzPXsuZ6q0lSIm40X3V1ZVGj6mlreWfBt/GOmkAhcsQuIRpM2cmdAawFfFfH5RrOL8vw6Fo0mMvEYm5wUyDajhOxos3Ht3u1trVreG4zfKdpH/X/oSb8mWSTw/qWBNGRY+uo5+NwHdMplsfi4YfwEEhJu5MScAJ4fuYemWRXrYrdHz3HifI+WEWmHW+lf6Inmr37r4az9p3gpaiHdVUf2xhkTSR7NIHnrudDMbPuR/qJPcUf94r7CW2X6DegWwBM1jSH7Tn8zNWYlfyaLB50kVc2QDAHMlsU/o3pz7q/lMP7w6NDe0SzXrok6BwpL7CMxD+Sx1IpzuWTjEt7e8FYRbTPXEOUOtMBB0n1B8vFTt6DGdpRV7RVzTRH27VG70lHHXAwEJCctuNOOChHdy0jZz0BckFcZkMSsZU0WVFxmjimSbesT5u1RGtTvV/2w++MP8DMrMWYzj+oOZzVfB7VO539X63uZr5f2WuGxg4QLty9MpVxun6d3G8y1sA+cdOvVM4CCftfpXPfHoU7O8f3FToKvo9yq+FC8WGbBu6hyjZKd5oyJHUAjjQ7jjS4PIHn+kUU8fkwq0/TVq8RG9hXR++oWqZXiQdrZQfd7/A+X54if6OsVzmrI3AHgIWNGdIVHYMlVrqXD1/C/QpplsSjnc2U8PHsk0oQ4bZL3godZlEIs53q360BKIW77ir5ndZ4faZ5E6eyc7S23RkDCyVC75fAhM0JWnYqcR8k9LOuodvLWBCTH1rt5We5wTGFDcMVM/5ffCko9xfGbVdnNLHtS8Hw8swMA5dgcqNyrQ15hvbnEz0DSrViyQr7Hw7y3XzkbhnlPmiz0eg6mWPzyZVPoN7FxjKPs7jRDkgle/uj3qv9HhN3ROKvCNH+2Xg6leiKAP0fhDt+/wpJQYQp1NNnvpavjCI6LwxJ6oQFul8W8V7GiAB9ZxT6Dtt3RyJ42JgWAoT2+HaJO9aNFpSmbBei0rNs1oqpvYnxBveko1qJ5LiA7XCLMW55te2GJ1ifWoAGuFV7fP7mKse7T3v0vh2iRD/88KrhwxQPicQW9PGbSSZv3k97D8ZqMcy55Lq3IdG06XuhJyY1Zd3Fo/K2pEVWS113GxxfoCwnZE+rlBhk5719/ML5BE2EwNvwzJ+3RrUG020ntttnosHQodHvVmyZE73Up9j98qXsNqFqoo4ELQ7R3A8/b+FlqYpDPP7/WQLhNnyx2KFwqw9g9tOuSnCkmoPqi5QHo2n29/BpTUklaeBcKtXv6hFr0Z51ONyOpTbRLZiJDGcnjFyB+Hf7hbU3hMF/aGcx0c5SjU1eSpGOsX5mEevhS1AAO6Ix/qiOaDOD0jlSXtf5LI2DnStElgYWQ5PzT0icng0gHIFN42pZOLIyC6d1DCwwGSVMm8MirR3RiOcucNA+soxxxet8fv48g1biMiqPTVJUpDEaxhchbmG8nTp//a6Lc8z0RwOuSEKkHuWNkRpKE0nSQOHZgDqSzFCtD/ns9HKg+o/58QFwc7xLAHlgA3Jms3JiQK1mvKCpcQyEm2OZzkgEkNF5qwyGafMt/a1aas4XWsB/IaQDZFzem77u7oKOGmXCEt6OlUpzp+0MqlIgeWOPKVICJsAEaX3qzHtbuC1Ti+eBTbXUGaq9PrhRyFYOrDhJXxQAvMrNVyB58eQXmDWnHc/X0viyll7uUjb1fipd1ody6L3AcCIH2cWAhc0GIj7zwZtSiMO8JrFcSvVPlMAx0Y2bw9m9vM9lmBfQcr/i8vI8ITmOofvO8Ex2x0JTOWsBZTBlY4XOl77EYVjOsAHeO1Gc1rZj4KH6fWPusOwpjcTl/4Qi0PI5CbgkZRBbecJRXRPYyHozc94QaJfK5DKFiODxN1PNPprFWjYLO2r4C5VyCGbTyTyxNaPpEO2kd+dCSDvl4mOZJdb74KuVFkauNkHY/jNpxl8z1hnstORJiIYwGy4ru8fiZ5aDqitSxLW9BdNXEV8sEVQIvKuwUjziMo/4jWw8R62rI+Ig1XWghiszqa/O1Mn/lG7sa017aQf2tka6nzlih2Mr5yPD9+LyMveTYzBck/i1hIb/Y7QJqg/aGN8XsGCGvj/c2fI621GNmu0UKWztYs7g0D96C7zSxhGEwE2EB0xSq+Xu6bG6b/IzTs/TWaYMS/cLgM3hcpPnaCSAnBSCAIt69JK3n1NerNUozqIIvBtgA3VUcCAGUrgz60zN8bOTpx4lsSgyPAtv7B+wJ0SFpoznLnniyhO7NkmacmB9lS2Vf3m7EKdqF1WuJrHwrZGCSSKo94JcfitQuSzSI6bS+8EuY1EjfFwJ53s0Rur6strD+UEahRe7wvqVhe1/K0wVLhwV3B0YxLld0Jjmtan0ezCGbN8CjqMUDlTqiHe2eN9Rs/tw5eZeDH8oZxcyXsXtLtw1fld15aVcpyWP0Oz83UT8kA0hSa42mzyTTzS9ep9VrdU8XfsMuFXdPEY+jHS0vzay6bSH8IcoeikplhgW4d7tbqxND3OU81wEYK6WtHuqAChHLe1Q19cPvzyxv/5SGUKBWHjC+leeDGuQ8TNQAwDwaAlXpitcWhwNa03gIG339cCiLUi3B9EHuQDroa+8LmHHQSzhlcpRmNBHn7/j3X8gCM8s7Y/yEknpdHCFv+mGnNq+XMkUrNzHnn2IdSA5MFT8UVtZQyXWSQbq+qfJQn2E3RT6i7JeWfD6vWQUkYw2h15XwrGxxzV0UvP+7qXE4jJOrmrmifRvIfvzDOYiQcfwV60tCT2YnmZcuGaU7actk/Vvb8Fve+2WsQq2yZ9LIJQrognIUPeWVWX7LYZspK/Kx5IysOLJPbbiA1KJ/eux38UzF0mOw5aGvBfQfP7pEDs6Cpi7Ixjw02Hk13/2FKWiar2s/MjTaoIFUNxqvPx9PprI1+8cJ5yzyUZbbJzNsGsVjqKmUc+YSo3ytz/fPn3nmaS4wsJqtYHOpZhD98Qnz76WzFXdOu95Ior8/n6hccKN/kSKFtsI+F9f0R37WkX0HD8YwqUMs0f9+r95ywDiBJmkDW04blpkDjVD+Pa9ruA24rOM8wCGyICM1XiXnhSyza/rLHFx8iylvhJ/icm2YG0zeleAgG/CUQNd6sx1QIUOdFQRsH92h8jgiDKoTsvs3mfeAsBA/gwRzVY/is81ZJLOuVhp4gkTOR6cmMf1k6SDn5LvoWlkpgmbQ9jvE7oQOMX5Qtm1nSaAGo9sVS8/nMFP0yE6AnZrHTyE0n3/E9l1Ad47KQUseSlypaAMCqgNsv2b2A5os7CG3jBI2UjHdG3A6u/2v47i1AW1eSUBk0X1cnMG7Jj1g3ooR0UrobJzlss2S4ZpPkBN6d3wcYGF/cUOfUtVF2M++ho/ju9LflfzD/xQsgV8rYNs1kn3VTLVIe9LLI4MbQFeNeL9/M14q8v5HY5w8B35fU1PCEktmBZsYmNG+NjdBpfV1a9/8J/I0zdW3uNoRPiK2vuWgGs2a1NXZTzgZpux88amyUDSmicboZTjoMEpKlVV6xduhyMTd7KKlwTghNEaMo61w5MPGTVre3y6sTmPBxIPk1xPOzQqXd80pxLnSb5pFUWTOwSDYjIYkOmhOP2AVcjVNE2Wy3OFCjznNEO+qy5lJtmP0uQ7PtiOCvtk1UlaHDjA7XMKIQSal9lKfHqTG3sJGUaAUONwrOWjxmElWPiwFy2w6VHqhG9wvmADAUILDralN98FiEX611HUwQd5NQdOWqpCQHnkm4X1/hVgrML1lL/ZiKmE9rAXl2Ht+hGMqtHgvV55zO6TvzgOLze2MQ7Yc2DURTYkLeHMb06MGS+q+HHveSr0UjKQHg0WsWhH1qcofGkrUdrrRsPOV2VKpIR5CXmynl/v3sPX3f1DKwcFva9kp2gPLv3mlA5D5SrgAlXqReJjHMZqQ2MRTAWcrkUIqJanSNH6XRERpK67SreXLjnR482/VKH0sIgG/7Xsr1vsh1sXhh7vCZ9jYLpAZzzlLT7hFYITxs5b6aD9xff/EXAwXt0HJ7Eoa6giUyhm8YD4EDGQ09mZkHQnH0riqPYYMF10gavdbxNIj4t83OxYGFxJGsI3d+IN7RgN3Yk2V0JA5lnxnKI/i1kxQ1F+XUOs2x8SMSJxS7KtcjwBzcU/1FE8SZIROYViQucV2M8ImEBHfx9EnvclOotq9ZcSLRooaP+UFsoFcYGv/vvUWa/KE5gqNd1eD7EYmlyyHTNwIr74VyY1RkyTblc2S5cci8q+suYBCKyfyYDizl4S16QsNim6ILMPVIqePl1Palju2SWtz6w2aOTsLRhA62iRTEGLdXVMGCtV/n0apXUURoTzArUPhg/X28sAo6H+gsoeBXo4WbSUljZcWEHt8yH+Vomjo+FADYm84quV3/nVXcrTIfIC1racxHN/dKB2m27QSQDinQ3j9FPrPzBDRWmTosrm8Vm59A/lV43AfmiJxZqEeVl8CJu4Ipw1Ac/NP6sr0n/U3/wbGOHg2Y75l7/F+t7jG1zB884taCI50fWyb+I3FUc2q7To9itJOj9eG9aFzWw01RTgFwPLOtfkGypOuRzzl9wbks4Rylsy+Gnn9VpKNi2j2md2JzI9UIUTRnKzGnHJux7pG3JaoqlL5biJ2BgTg6Ueeq/s7Vc7KiRZRpL2DT2fxYEpf5J31Z/XTjfmK5piO5YvmSu7FBJymgTd4/KK8ttGKKtqMKiyFcZmZ6WPYEkkA1gzn8i6c9IIOi5aTOEcbgJpufoUoOd8a2S+3L2HZgBVKT8/1q+8M0eps9GOi4mfnL044XrsQMgwliCD6xRVY4BlH19erJezuG5P9y1126yRm3brjIFeqzrKfiGzwsfrFBnsABG0CqMHUvVnP/yeTs4Exx0SUhwzZS5ZgsoWK90zNhXLkJcCQNN6z9Zh2tLNYM7Wfkgykd0rT3lAomNq6zFOm7uy6fKiI0cKpNecV3LvN1P3sW02nDplcjz7ekcDJlOEN3UkWTLbBr92YeUJ2Bb5iMTBjwcSE6bRu+aZokL50PnSBy5jyG3bsTL/1XpFzuynt+23SwNDxX4KT7QVhmDK1EVomodrOCNEVoh0WIGYVkqcFGgAzN9zG8TOF1fy+lua+4MBYov97P2H5prWDMo1mIM97xyQKx7W9V6uQ8rt0hoP54FR0ZTTem3FJ+lmJZ8n7rC9apH+7PYvxwTumCYE1FZjcCXNGE8m+9RvQXy+Ii5o4tjmrT6qsgIH9a0omf9YGy7B2RBizTbIW8QaPvJafMgdQh253XINS1oi+4N6hbOY1oz2qUPoiMDBXpLqhWJ093PX7T+pnXwNvLaQLd2v0vOnVLS7E/zcbdd+gqpKJUKlzznDR0lEw3bOo1PlnnFxNxVbeaBLGjppjykKQM/GaN/A6xfvuVoeSv7AXGqdtrVK02VOJ9DTLknxWfYkqNiO4hr2rn5rtQYecmu4SwA3u5qEGXxd6IB6iph3znR+W31wY7++JzP12pr61l85IJF/kcd6TYB0Sufb9WmJh";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
