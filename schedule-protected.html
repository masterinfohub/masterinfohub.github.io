<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
